<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أوقات الصلاة - مكة المكرمة</title>
    
    <!-- تضمين الخط -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/moment@2.30.1/min/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment-hijri@3.0.0/moment-hijri.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #eef2f7;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: url('Screen saver-0.jpg') no-repeat center center fixed;
            background-size: cover;
            color: black;
            text-align: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.15);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            width: 85%;
            max-width: 700px;
            backdrop-filter: blur(10px);
        }

        .prayer-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1.2em;
            margin-top: 20px;
        }

        .error-message {
            color: red;
            font-size: 1.3em;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="title">أوقات الصلاة - مكة المكرمة</h1>
        <div class="date-container" style="margin-bottom: 10px;">
            <div id="gregorian-date"></div>
            <div id="hijri-date"></div>
        </div>
        <div class="current-time" id="current-time"></div>

        <div class="next-prayer">
            <div id="next-prayer-name"></div>
            <div id="next-prayer-time"></div>
            <div id="time-remaining"></div>
        </div>

        <!-- جدول أوقات الصلاة -->
        <table class="prayer-table" id="prayer-table">
            <thead>
                <tr id="table-header"></tr>
            </thead>
            <tbody id="prayer-times"></tbody>
        </table>

        <div class="error-message" id="error-message"></div>
        <audio id="azan-audio" src="azan.mp3" preload="auto"></audio>
    </div>

    <script>
        const API_URL = "https://api.aladhan.com/v1/timingsByCity?city=Makkah&country=Saudi%20Arabia&method=4";
        let lastAzanPlayedTime = null;
        let language = 'ar';
        let nextPrayer = { name: "", time: "" };
        let nextPrayerTime = null;

        const translations = {
            ar: {
                title: "أوقات الصلاة - مكة المكرمة",
                nextPrayer: "الصلاة القادمة",
                time: "الوقت",
                remaining: "المتبقي",
                gregorianDate: "التاريخ الميلادي",
                hijriDate: "التاريخ الهجري",
                prayers: ["الفجر", "الظهر", "العصر", "المغرب", "العشاء"],
                error: "فشل في تحميل أوقات الصلاة"
            },
            en: {
                title: "Prayer Times - Makkah",
                nextPrayer: "Next Prayer",
                time: "Time",
                remaining: "Remaining",
                gregorianDate: "Gregorian Date",
                hijriDate: "Hijri Date",
                prayers: ["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"],
                error: "Failed to load prayer times"
            }
        };

        async function updatePrayerTimes() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                const timings = data.data.timings;
                const now = new Date();
                // now.setDate(now.getDate() + 1);


                function to12HourFormat(time) {
                    let [hours, minutes] = time.split(':').map(Number);
                    let period = language === 'ar' ? (hours >= 12 ? 'م' : 'ص') : (hours >= 12 ? 'PM' : 'AM');
                    hours = hours % 12 || 12;
                    return `${hours}:${minutes.toString().padStart(2, '0')} ${period}`;
                }

                const prayersList = ["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"].map((prayerName, index) => ({
                    name: translations[language].prayers[index],
                    time: to12HourFormat(timings[prayerName])
                }));
               nextPrayer = prayersList.find(p => new Date(now.toDateString() + ' ' + p.time) > now) || prayersList[0];

                document.getElementById('prayer-times').innerHTML = prayersList.map(p => `<td>${convertNumbers(p.time)}</td>`).join('');

                updateText();
                updateRemainingTime();
            } catch (error) {
                document.getElementById('error-message').textContent = translations[language].error;
            }
        }

        function updateRemainingTime() {
    if (!nextPrayer || !nextPrayer.time) return;

    const now = moment();


    let prayerTime = moment(`${now.format('YYYY-MM-DD')} ${nextPrayer.time}`, 'YYYY-MM-DD hh:mm A');
    
    if (prayerTime.isBefore(now)) {
        prayerTime.add(1, 'days');
    }

    const remainingTime = prayerTime.diff(now);
    const duration = moment.duration(remainingTime);

    const hours = duration.hours();
    const minutes = duration.minutes();
    const seconds = duration.seconds();

    const formattedHours = convertNumbers(String(hours).padStart(2, '0'));
    const formattedMinutes = convertNumbers(String(minutes).padStart(2, '0'));
    const formattedSeconds = convertNumbers(String(seconds).padStart(2, '0'));

    const timeText = `${formattedHours}:${formattedMinutes}:${formattedSeconds}`;

    document.getElementById('time-remaining').textContent = timeText;

    if (remainingTime <= 0) {
        playAzan();
    }
}


        function convertNumbers(text) {
            const arabicNumbers = "٠١٢٣٤٥٦٧٨٩";
            return text.replace(/\d/g, d => language === 'ar' ? arabicNumbers[d] : d);
        }

        function playAzan() {
            const now = new Date();

            if (!lastAzanPlayedTime || lastAzanPlayedTime.toDateString() !== now.toDateString() || 
                lastAzanPlayedTime.getHours() !== now.getHours() || lastAzanPlayedTime.getMinutes() !== now.getMinutes()) {
                
                document.getElementById('azan-audio').play();
                lastAzanPlayedTime = now;
            }
        }

        function updateText() {
            document.getElementById('title').textContent = translations[language].title;
            document.getElementById('next-prayer-name').textContent = `${translations[language].nextPrayer}: ${nextPrayer.name}`;
            document.getElementById('next-prayer-time').textContent = `${translations[language].time}: ${convertNumbers(nextPrayer.time)}`;
            document.getElementById('gregorian-date').textContent = `${translations[language].gregorianDate}: ${convertNumbers(moment().format('YYYY-MM-DD'))}`;
            document.getElementById('hijri-date').textContent = `${translations[language].hijriDate}: ${convertNumbers(moment().format('iYYYY-iMM-iDD'))}`;
            document.getElementById('prayer-table').style.direction = language === 'ar' ? 'rtl' : 'ltr';
            document.getElementById('table-header').innerHTML = translations[language].prayers.map(p => `<th>${p}</th>`).join('');
        }

        function switchLanguage() {
            language = language === 'ar' ? 'en' : 'ar';
            updatePrayerTimes();
        }
        setInterval(updateText, 6000); 
        updatePrayerTimes();
        // setInterval(updatePrayerTimes, 60000);
        setInterval(updateRemainingTime, 1000); // Update every second
        setInterval(switchLanguage, 6200); // Switch language every 5 seconds
    </script>
</body>
</html>
